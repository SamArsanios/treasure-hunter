<!DOCTYPE html>
<html lang="en">

<head>
  <!-- <script src="https://cdn.jsdelivr.net/npm/phaser@3.54.0/dist/phaser-arcade-physics.min.js"></script> -->
  <script src="//cdn.jsdelivr.net/npm/phaser@3.54.0/dist/phaser.min.js"></script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div id="game"></div>
  man
</body>
<script>
  const phaserConfig = {
    type: Phaser.AUTO,
    parent: "game",
    width: 1280,
    height: 600,
    backgroundColor: "#5DACD8",
    physics: {
      default: "arcade",
      arcade: {
        debug: true
      }
    },
    scene: {
      init: initScene,
      preload: preloadScene,
      create: createScene,
      update: updateScene
    }
  };

  const game = new Phaser.Game(phaserConfig)

  var cloudsBlue
  var cloudsWhite;
  var cloudsWhiteSmall;
  var plane;
  // var explosion;
  var coin;
  var obstacle;
  var isGameOver = false;

  var isClicked = false;

  function initScene() {

  }

  function preloadScene() {
    this.load.image("clouds-blue", "blue.png");
    this.load.image("clouds-white", "white-clouds-1.png");
    this.load.image("clouds-white-small", "white-clouds-small.png");
    this.load.atlas("plane", "plane.png", "plane.json")
    // this.load.spritesheet("plane", "plane.png", { frameWidth: 512, frameHeight: 512 });
    this.load.spritesheet("explosion", "explosion.png", { frameWidth: 512, frameHeight: 512 });
    this.load.image("coin", "coin.png");
    this.load.image("obstacle", "obstacle.png");
  }

  function createScene() {
    cloudsBlue = this.add.image(640, 360, "clouds-blue");
    cloudsWhite = this.add.tileSprite(640, 360, 1280, 720, "clouds-white");
    cloudsWhiteSmall = this.add.tileSprite(640, 360, 1280, 720, "clouds-white-small");

    this.anims.create({
      key: "fly",
      frameRate: 7,
      frames: this.anims.generateFrameNames("plane", {
        prefix: "plane-",
        suffix: ".png",
        start: 1,
        end: 4,
        zeroPad: 1
      }),
      repeat: -1
    });
    this.anims.create({
      key: "explosion",
      frameRate: 7,
      frames: this.anims.generateFrameNames("plane", {
        prefix: "smoke-",
        suffix: ".png",
        start: 1,
        end: 4,
        zeroPad: 1
      }),
      repeat: 2
    });
    this.anims.create({
      key: "explode",
      frameRate: 7,
      frames: this.anims.generateFrameNumbers("explosion"),
      repeat: 2
    });
    plane = this.physics.add.sprite(100, 512, "plane");
    plane.setDepth(1);
    plane.setScale(0.25);
    plane.play("fly");

    coin = this.physics.add.sprite(500, 512, "coin");
    coin.setScale(0.15);
    coin.setCircle(250);

    obstacle = this.physics.add.sprite(900, 512, "obstacle");
    obstacle.setScale(0.3);

    this.physics.add.collider(plane, coin, function (plane, coin) {
      coin.x = 1400;
      // plane.play("explosion");
    });

    this.physics.add.collider(plane, obstacle, function (plane, obstacle) {
      if (!isGameOver) {
        plane.play("explosion");
        plane.once(Phaser.Animations.Events.ANIMATION_COMPLETE, () => {
          plane.destroy();
        });
        isGameOver = true;
      }

    });


  }

  function updateScene() {
    cloudsWhite.tilePositionX += 0.5;
    cloudsWhiteSmall.tilePositionX += 0.25;
    coin.x -= 4;
    obstacle.x -= 3;

    if (this.input.activePointer.isDown) {
      isClicked = true;
    } else if (!this.input.activePointer.isDown && isClicked) {
      isClicked = false;
      var explosion = this.add.sprite(
        this.input.activePointer.position.x,
        this.input.activePointer.position.y,
        "explosion"
      );
      explosion.once(Phaser.Animations.Events.ANIMATION_COMPLETE, () => {
        explosion.destroy();
      });
      explosion.setScale(0.2);
      explosion.play("explode");
    }
  }

</script>

</html>